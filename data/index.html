

<style>
* { font-family: sans; }
div {  display: table; margin: 10px; padding: 10px; border-radius: 10px; background-color: rgba(0,0,0,0.2); }
</style>

<div>
  <h2>Position</h2>
  <div>
    Actual: <input id=position disabled>
    Target:   <input id=target onchange="set(this)">
  </div>
  <div>
    <h3>Enable / Error</h3>
    Enabled:  <input id=enable onchange="set(this)"> Alarm: <input id=alarm disabled> (reset by disable / enable)
  </div>
  <div>
  <h3>Homing</h3>
    Home to target: <input id=home onchange="set(this)">
    Reset position to: <input id=set_position onchange="set(this)">
  </div>
</div>

<div>
  <h2>Config</h2>
  <div>
    <h3>ArtNet DMX Input</h3>
    DMX Channel:<input id=channel onchange="set(this)">
    DMX Scale:    <input id=scale  onchange="set(this)">
  </div>
  <div>
    <h3>Motion</h3>
    <p>Speed:    <input id=speed  onchange="set(this)"></p>
    <p>Accel:    <input id=accel  onchange="set(this)"></p>
  </div>
</div>

<script>
function set(el) {
  let param = el.id;
  fetch(`/set?${param}=${el.value}`);
  el.blur();
  el.value = '';

  update_config();
}

function show(id, value) {
  let el = document.getElementById(id);
  if(el != document.activeElement)
    el.value = value;
}
  
setInterval(async()=>{
  let body = await(fetch("/status").then(r => r.text()));
  let parts = body.split(' ');
  show('target'  ,parts[0]);
  show('position',parts[1]);
  show('enable'  ,parts[2]);
  show('alarm'   ,parts[3]);
},500);

async function update_config(){
  let body = await(fetch("/config").then(r => r.text()));
  let parts = body.split(' ');
  show('channel' ,parts[0]);
  show('scale'   ,parts[1]);
  show('speed'   ,parts[2]);
  show('accel'   ,parts[3]);
};

update_config();
</script>

