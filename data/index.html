

<style>
* { font-family: sans; }
div {  display: table; margin: 10px; padding: 10px; border-radius: 10px; background-color: rgba(0,0,0,0.2); }
</style>

<div>
  <h2>Position</h2>
  <div>
    Actual: <input id=position disabled>
    Target:   <input id=target onchange="set(this)">
  </div>
  <div>
    <h3>Enable / Error</h3>
    Enabled:  <input id=enable onchange="set(this)"> Alarm: <input id=alarm disabled> (reset by disable / enable)
  </div>
  <div>
  <h3>Homing</h3>
    Home to target: <input id=home onchange="set(this)">
    Reset position to: <input id=set_position onchange="set(this)">
  </div>
</div>

<div>
  <h2>Config</h2>
  <div>
    <h3>ArtNet DMX Input</h3>
    DMX Channel:<input id=channel onchange="set(this)">
    DMX Scale:    <input id=scale  onchange="set(this)">
  </div>
  <div>
    <h3>Motion</h3>
    <p>Speed:    <input id=speed  onchange="set(this)"></p>
    <p>Accel:    <input id=accel  onchange="set(this)"></p>
  </div>
</div>

<script>
function set(el) {
  let param = el.id;
  fetch(`/set?${param}=${el.value}`);
  el.blur();
  el.value = '';

  fetch_and_show("/config");
}

function show(id, value) {
  let el = document.getElementById(id);
  if(el != document.activeElement)
    el.value = value;
}

async function fetch_and_show(url) {
  let body = await(fetch(url).then(r => r.text()));
  let lines = body.split('\n');
  for(let line of lines) {
    let parts = line.split(/ (.*)/s); // split on first " " only
    if(parts[0])
      show(parts[0],parts[1]);
  }
}

setInterval(()=>fetch_and_show("/status"),500);

fetch_and_show("/config");

</script>

